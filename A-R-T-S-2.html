<!DOCTYPE html>
<html>
<head>
    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Page Meta -->
    <title>ARTS-第二周</title>
    <meta name="description" content="不如自己打井，多谈钱，少谈情怀" />

    <!-- Mobile Meta -->
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Brand icon -->
    <link rel="shortcut icon" href="assets/images/favicon.ico" >

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="assets/css/screen.css" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="assets/css/syntax.css" />

    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>

    <!-- Ghost outputs important style and meta data with this tag -->
        <link rel="canonical" href="http://www.v0ex.com/A-R-T-S-2.html" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="page2/" />

    <meta property="og:site_name" content="等天下雨" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="ARTS-第二周" />
    <meta property="og:description" content="不如自己打井，多谈钱，少谈情怀" />
    <meta property="og:url" content="http://www.v0ex.com/A-R-T-S-2.html" />
    <meta property="og:image" content="assets/images/cover1.jpg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="ARTS-第二周" />
    <meta name="twitter:description" content="不如自己打井，多谈钱，少谈情怀" />
    <meta name="twitter:url" content="http://www.v0ex.com/A-R-T-S-2.html" />
    <meta name="twitter:image:src" content="assets/images/cover1.jpg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "等天下雨",
    "name": "ARTS-第二周",
    "url": "http://www.v0ex.com/A-R-T-S-2.html",
    "image": "assets/images/cover1.jpg",
    "description": "不如自己打井，多谈钱，少谈情怀"
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="等天下雨" href="feed.xml" />


</head>
<body class="home-template nav-closed">

    <!-- The blog navigation links -->
    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a href="">Home</a></li>
        <li class="nav-about " role="presentation"><a href="about">About</a></li>
        <li class="nav-fables " role="presentation"><a href="tag/fables">Fables</a></li>
        <li class="nav-speeches " role="presentation"><a href="tag/speeches">Speeches</a></li>
        <li class="nav-fiction " role="presentation"><a href="tag/fiction">Fiction</a></li>
        <li class="nav-author " role="presentation"><a href="author/casper">Casper</a></li>
    </ul>
    <a class="subscribe-button icon-feed" href="feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-fiction">

        <header class="post-header">
            <h1 class="post-title" style="text-align:center">ARTS-第二周</h1>
            <section class="post-meta">
            <!-- <a href=''></a> -->

            
                
            
            <time class="post-date" datetime="2019-03-25">26 Mar 2019</time>
                <!-- [[tags prefix=" on "]] -->
                
                on
                
                    
                       <a href='tag/arts'>Arts</a>,
                    
                
                    
                       <a href='tag/极客时间'>极客时间</a>,
                    
                
                    
                       <a href='tag/LeetCode'>Leetcode</a>,
                    
                
                    
                       <a href='tag/左耳朵耗子'>左耳朵耗子</a>
                    
                
                
            </section>
        </header>

        <section class="post-content">

            <p>ARTS-第二周
<!--more--></p>
<h2 id="algorithm">Algorithm</h2>

<blockquote>
  <p><a href="https://leetcode.com/problems/subsets/">78题</a></p>
</blockquote>

<p>给定一组不同的整数，返回所有可能的子集。</p>

<p><strong>注意</strong>：解决方案中不能包含重复的子集。</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>输入：nums = [1,2,3]
输出：
[
  [3],
  [1],
  [2],
  [1,2,3],
  [1,3],
  [2,3],
  [1,2],
  []
]
</code></pre></div></div>

<p><strong>解题思路1</strong> 非递归，非位运算，非深度优先</p>

<p>当遍历所有数字时，对于每一个新的数字，我们可以选择它，或者不选择它。</p>

<ol>
  <li>如果选择它，就把它加入到已生成的所有的子集中。</li>
  <li>如果不选它，只需要保留现有的子集。</li>
</ol>

<p>对于上述示例，{1,2,3}最初我们可以生成一个空的集合，[[]]</p>

<ul>
  <li>
    <p>对于数字1，如果不选1，结果集还是[]，如果选1，就把1添加到[]中，此时就获得新的子集[1]，合并两个子集，然后我们就获得了结果集[[],[1]]。</p>
  </li>
  <li>对于数字2，如果不选择2，结果集还是[[],[1]]。如果选择2，把2添加到现有的所有子集中，然后我们获得了新的子集[2],[1,2]，合并所有子集，我们就获得了结果集[[],[1],[2],[1,2]]</li>
  <li>同理对于数字3，选择以后，我们就获得了新的子集[3],[1,3],[2,3],[1,2,3]，合并所有子集，我们就获得了这组整数的所有子集集合[[],[1],[2],[1,2],[3],[1,3],[2,3],[1,2,3]]</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public List&lt;List&lt;Integer&gt;&gt; subsets(int[] nums){
    List&lt;List&lt;Integer&gt;&gt; result = new ArrayList&lt;&gt;();
    result.add(new ArrayList&lt;&gt;());
    for(int n : nums){
        int size = result.size();
        for(int i=0;i&lt;size;i++){
            List&lt;Integer&gt; subset = new ArrayList&lt;&gt;(result.get(i));
            subset.add(n);
            result.add(subset);
        }
    }
    return result;
}
</code></pre></div></div>

<p><strong>解题思路2</strong> 递归</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public List&lt;List&lt;Integer&gt;&gt; subsets(int[] nums){
    List&lt;List&lt;Integer&gt;&gt; result = new ArrayList&lt;&gt;();
    Arrays.sort(nums);
    backtrack(result,new ArrayList&lt;&gt;(),nums,0);
    return result;
}

private void backtrack(List&lt;List&lt;Integer&gt;&gt; list,List&lt;Integer&gt; tempList,int[] nums,int start){
    list.add(new ArrayList&lt;&gt;(tempList));
    for(int i = start;i &lt; nums.length; i++){
        temp.add(nums[i]);
        backtrack(list,tempList,nums,i+1);
        tempList.remove(tempList.size()-1);
    }
}
</code></pre></div></div>

<h2 id="review">Review</h2>

<blockquote>
  <p><a href="https://medium.com/cheddar/q-a-instagrams-new-head-of-product-vishal-shah-8ebba9241591">对Instagram的新产品负责人的专访</a></p>
</blockquote>

<p>该访谈主要围绕Instagram进军电子商务的计划，谈论了Instagram两位联合创始人的原因，还有一个比较有争议的计划，那就是Facebook打算整合其一系列的应用程序，来提高各个应用的互通性。</p>

<p>关于Instagram上购物，类似于平时我们浏览图片时，可以点击图片然后跳转到购买页面。</p>

<p>也不知道是老外抄袭我们的技术还是我们抄袭老外的，哈哈。</p>

<h2 id="tip">Tip</h2>

<p>MongoDB作为一个内存数据库，对于数据的操作大部分都是在内存中的。日常使用MongoDB的过程中，常常会需要对数据进行分页。</p>

<p>常见的<strong>MongoTemplate分页</strong>查询</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import java.util.List;

/**
 * Created by bugcoder.
 */
public class PageModel&lt;T&gt; {
    //结果集
    private List&lt;T&gt; datas;

    //查询记录数
    private int rowCount;

    //每页多少条数据
    private int pageSize=20;

    //第几页
    private int pageNo=1;

    //跳过几条数
    private int skip=0;

    /**
     * 总页数
     * @return
     */
    public int getTotalPages(){
        return(rowCount+pageSize-1)/pageSize;
    }

    public int getRowCount() {
        return rowCount;
    }

    public void setRowCount(int rowCount) {
        this.rowCount = rowCount;
    }

    public int getPageSize() {
        return pageSize;
    }

    public void setPageSize(int pageSize) {
        this.pageSize = pageSize;
    }

    public int getPageNo() {
        return pageNo;
    }

    public void setPageNo(int pageNo) {
        this.pageNo = pageNo;
    }

    public int getSkip() {
        return skip;
    }

    public void setSkip(int skip) {
        this.skip = skip;
    }


    public List&lt;T&gt; getDatas() {
        return datas;
    }

    public void setDatas(List&lt;T&gt; datas) {
        this.datas = datas;
    }
}
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Sort;

import java.io.Serializable;

/**
 * Created by bugcoder.
 */
public class MongoDataPageable implements Serializable,Pageable{

    private static final long serialVersionUID = 1L;

    // 当前页
    private Integer pageNo = 1;

    // 当前页面条数
    private Integer pageSize = 10;

    // 排序条件
    private Sort sort;

    @Override
    public int getPageNumber() {
        return getPageNo();
    }

    @Override
    public int getPageSize() {
        return pageSize;
    }

    @Override
    public int getOffset() {
        return (getPageNumber() - 1) * getPageSize();
    }

    @Override
    public Sort getSort() {
        return sort;
    }

    @Override
    public Pageable next() {
        return null;
    }

    @Override
    public Pageable previousOrFirst() {
        return null;
    }

    @Override
    public Pageable first() {
        return null;
    }

    @Override
    public boolean hasPrevious() {
        return false;
    }

    public Integer getPageNo() {
        return pageNo;
    }

    public void setPageNo(Integer pageNo) {
        this.pageNo = pageNo;
    }

    public void setPageSize(Integer pageSize) {
        this.pageSize = pageSize;
    }


    public void setSort(Sort sort) {
        this.sort = sort;
    }
}
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import com.ai.bugcodes.domain.File;
import com.ai.bugcodes.message.base.BaseMessage;
import com.ai.bugcodes.openapi.service.mongo.IImMessageFileMongoSV;
import com.ai.bugcodes.openapi.service.mongo.utils.MongoDataPageable;
import com.ai.bugcodes.openapi.service.mongo.utils.PageModel;
import com.mongodb.DBObject;
import com.mongodb.WriteResult;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageImpl;
import org.springframework.data.domain.Sort;
import org.springframework.data.mongodb.core.MongoTemplate;
import org.springframework.data.mongodb.core.query.BasicQuery;
import org.springframework.data.mongodb.core.query.Criteria;
import org.springframework.data.mongodb.core.query.Query;
import org.springframework.data.mongodb.core.query.Update;
import org.springframework.stereotype.Service;

import java.util.ArrayList;
import java.util.List;

/**
 * Created by bugcoder.
 */
@Service
public class IImMessageFileMongoSV implements IImMessageFileMongoSV {

    @Autowired
    private MongoTemplate mongoTemplate;

    @Override
    public BaseMessage findByMessageId(String messageId) {
        return mongoTemplate.findOne(new Query(Criteria.where("id").is(messageId)),
                BaseMessage.class, "imMessage");
    }

    @Override
    public BaseMessage findByChannel(String channelId) {
        return mongoTemplate.findOne(new Query(Criteria.where("channel").is(channelId)),
                BaseMessage.class);
    }

    @Override
    public BaseMessage findByTypeAndChannel(String type, String channelId) {
        return mongoTemplate.findOne(
                new Query(Criteria.where("type").is(type).and("channel").is(channelId)),
                BaseMessage.class, "imMessage");
    }

    @Override
    public PageModel&lt;BaseMessage&gt; getImMessages(PageModel&lt;BaseMessage&gt; page, DBObject queryObject) {
        Query query = new BasicQuery(queryObject);
        // 查询总数
        int count = (int) mongoTemplate.count(query, BaseMessage.class);
        page.setRowCount(count);

        // 排序
        query.with(new Sort(Sort.Direction.ASC, "id"));
        query.skip(page.getSkip()).limit(page.getPageSize());
        List&lt;BaseMessage&gt; datas = mongoTemplate.find(query, BaseMessage.class);
        page.setDatas(datas);
        return page;
    }

    @Override
    public List&lt;BaseMessage&gt; findMessageByPage(int pageNo, int pageSize) {
        int startNum = (pageNo - 1) * pageSize;
        return mongoTemplate.find(new Query().skip(startNum).limit(pageSize), BaseMessage.class);
    }

    @Override
    public Page&lt;BaseMessage&gt; channelFilesQuery(Integer pageNum, Integer pageSize,
            String channelId) {
        MongoDataPageable pageable = new MongoDataPageable();
        Query query = new Query(
                Criteria.where("channel").is(channelId).and("type").in("file", "image"));
        List&lt;Sort.Order&gt; orders = new ArrayList&lt;Sort.Order&gt;(); // 排序
        orders.add(new Sort.Order(Sort.Direction.DESC, "ts"));
        Sort sort = new Sort(orders);

        // 开始页
        pageable.setPageNo(pageNum);
        // 每页条数
        pageable.setPageSize(pageSize);
        // 排序
        pageable.setSort(sort);
        // 查询出一共的条数
        Long count = mongoTemplate.count(query, BaseMessage.class);
        // 查询
        List&lt;BaseMessage&gt; list = mongoTemplate.find(query.with(pageable), BaseMessage.class);
        // 将集合与分页结果封装
        Page&lt;BaseMessage&gt; pagelist = new PageImpl&lt;BaseMessage&gt;(list, pageable, count);

        return pagelist;
    }

    @Override
    public Page&lt;BaseMessage&gt; myFilesQuery(Integer pageNum, Integer pageSize, String channelId,
            String accountId) {
        MongoDataPageable pageable = new MongoDataPageable();
        Query query = new Query(Criteria.where("channel").is(channelId).and("user").is(accountId)
                .and("type").in("file", "image"));
        List&lt;Sort.Order&gt; orders = new ArrayList&lt;Sort.Order&gt;(); // 排序
        orders.add(new Sort.Order(Sort.Direction.DESC, "ts"));
        Sort sort = new Sort(orders);
        // 开始页
        pageable.setPageNo(pageNum);
        // 每页条数
        pageable.setPageSize(pageSize);
        // 排序
        pageable.setSort(sort);
        // 查询出一共的条数
        Long count = mongoTemplate.count(query, BaseMessage.class);
        // 查询
        List&lt;BaseMessage&gt; list = mongoTemplate.find(query.with(pageable), BaseMessage.class);
        // 将集合与分页结果封装
        Page&lt;BaseMessage&gt; pagelist = new PageImpl&lt;BaseMessage&gt;(list, pageable, count);

        return pagelist;
    }

    @Override
    public void createCollectionsName(String collectionName){
        if (mongoTemplate.collectionExists(collectionName)){
            return;
        }
        mongoTemplate.createCollection(collectionName);
    }

    @Override
    public void insertFileData(File file,String collectionName) {
        if (mongoTemplate.collectionExists(collectionName)){
            mongoTemplate.insert(file,collectionName);
        }
    }

    public void addFileChannels(String channelId){
        Query query = new Query(Criteria.where("id").is("E41F1BA999114BCE848CA1F25D53944C"));
        Update update = new Update();
        update.addToSet("channels",channelId);
        WriteResult writeResult = mongoTemplate.upsert(query,update,File.class,"im_image");
        System.out.println("=========================");
        System.out.println(writeResult.toString());
    }
}
</code></pre></div></div>

<h2 id="share">Share</h2>

<p>Lucene学习笔记-<strong>布尔检索模型</strong></p>

<p>ElasticSearch基于Lucene实现，学习Lucene的底层实现，有利于我们更好的使用ES。</p>

<hr />

<ol>
  <li>
    <p>词项频率：同意单词在某个文档中出现的频率</p>
  </li>
  <li>
    <p>文档频率：出现某个词项的文档的数目</p>
  </li>
  <li>
    <p>倒排记录表：用于记录出现过某个单词的所有文档的文档列表，以及单词在改文档中出现的位置信息</p>
  </li>
  <li>
    <p>倒排文件：倒排记录表在磁盘中的物理存储文件称为倒排文件</p>
  </li>
  <li>
    <p>倒排索引：也被成为反向索引，一种索引方法，被用来存储在全文搜索下某个单词，在一个文档或一组文档中的存储位置的映射关系，它是文档检索系统中最常用的数据结构</p>
  </li>
</ol>

<p><strong>布尔检索模型</strong></p>

<p>布尔检索法是指利用布尔运算符连接各个检索词，然后由计算机进行逻辑运算，找出所需信息的一种检索方法。在改模型下，每篇文档被看成是一系列词的集合。</p>

<p>该模型下主要有三种逻辑运算</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AND(*) 、OR(+) 、NOT(-) 对应java中的(&amp;)、(|)、(~)
</code></pre></div></div>

<p><strong>用法</strong></p>

<p>假如有如下单词-文档矩阵</p>

<table>
  <thead>
    <tr>
      <th> </th>
      <th style="text-align: right">doc1</th>
      <th style="text-align: center">doc2</th>
      <th>doc3</th>
      <th>doc4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>谷歌</td>
      <td style="text-align: right">0</td>
      <td style="text-align: center">1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <td>开源</td>
      <td style="text-align: right">0</td>
      <td style="text-align: center">1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <td>大会</td>
      <td style="text-align: right">1</td>
      <td style="text-align: center">0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>

<p>想要查询包含谷歌和开源但不包含大会的文档：谷歌AND开源NOT大会</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0101
0101
0111(1000取反)
————————
0101
</code></pre></div></div>

<p><strong>结果：</strong> 向量中第2和第4个元素为1，则文档2和文档4是符合查询条件的文档</p>

<p>参考：«从Lucene到Elasticsearch全文检索实战»</p>



        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->
            
                
            

            <!-- Add Disqus Comments -->
            

        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
        <a class="read-next-story no-cover" href="A-R-T-S-3.html">
            <section class="post">
                <h2>ARTS-第三周</h2>
                <p></p>
            </section>
        </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev no-cover" href="A-R-T-S-1.html">
            <section class="post">
                <h2>ARTS-第一周</h2>
                <p></p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <!-- The tiny footer at the very bottom -->
        <footer class="site-footer clearfix">
          <section class="copyright"><a href="">等天下雨</a> &copy; 2019</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/jekyller/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- highlight.js -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- jQuery needs to come before `` so that jQuery can be used in code injection -->
    <script type="text/javascript" src="//code.jquery.com/jquery-1.12.0.min.js"></script>
    <!-- Ghost outputs important scripts and data with this tag -->
    <!--  -->
    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', '', 'auto');
	    ga('send', 'pageview');

     </script>
    <!-- Fitvids makes video embeds responsive and awesome -->
    <script type="text/javascript" src="assets/js/jquery.fitvids.js"></script>
    <!-- The main JavaScript file for Casper -->
    <script type="text/javascript" src="assets/js/index.js"></script>

</body>
</html>
